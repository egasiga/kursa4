# Протокол тестирования функций приложения для создания мемов

В данном разделе представлен протокол тестирования основных функций мемогенератора. Для каждой функции указано назначение, подробный план тестирования с конкретными действиями и техническая информация о взаимодействии компонентов.

## 1. Функция загрузки шаблонов мемов

**Назначение функции:**  
Функция выполняет запрос к API для получения списка доступных шаблонов мемов из хранилища и отображает их пользователю в виде сетки миниатюр для выбора. Обеспечивает стартовую точку взаимодействия с приложением.

**Протокол тестирования:**  
1. Запустите приложение, открыв главную страницу в браузере
2. В верхней навигационной панели найдите и нажмите на вкладку "Мемы"
3. Наблюдайте индикатор загрузки (анимированный спиннер), который отображается в центре страницы
4. Дождитесь завершения загрузки и появления сетки миниатюр шаблонов мемов

При выполнении этих действий происходит следующее: хук `useQuery` React Query отправляет GET-запрос к эндпоинту `/api/templates`. Сервер обрабатывает запрос через функцию в `routes.ts`, которая вызывает метод `getMemeTemplates()` из класса `MemStorage`. Полученные данные передаются клиенту и отображаются через компонент сетки шаблонов.

## 2. Функция выбора шаблона мема

**Назначение функции:**  
Позволяет пользователю выбрать конкретный шаблон мема для редактирования. Функция загружает изображение шаблона и создает текстовые поля в соответствии с метаданными шаблона.

**Протокол тестирования:**  
1. На странице генератора мемов найдите сетку доступных шаблонов в нижней части экрана
2. Выберите шаблон "Drake Hotline Bling" (или любой другой), щелкнув на его миниатюре
3. Обратите внимание, что выбранный шаблон появляется в основной области редактирования
4. Проверьте правую панель - там должны появиться текстовые поля, соответствующие шаблону (для шаблона Drake это два текстовых поля с подписями "Текст 1" и "Текст 2")
5. Убедитесь, что в текстовых полях отображается стандартный текст для этого шаблона

При выборе шаблона вызывается функция `handleTemplateSelect(template)`, которая:
- Устанавливает выбранный шаблон в состояние `selectedTemplate`
- Извлекает данные о текстовых областях из объекта шаблона
- Инициализирует массив `textContent` с начальными стилями для каждой текстовой области
- Переключает интерфейс с сетки шаблонов на редактор мема

## 3. Функция редактирования текста мема

**Назначение функции:**  
Обеспечивает возможность изменять текст и его визуальное оформление в выбранных областях мема. Позволяет настраивать шрифт, размер, цвет, обводку и выравнивание текста.

**Протокол тестирования:**  
1. После выбора шаблона убедитесь, что в правой панели активна вкладка "Текст"
2. В поле "Текст 1" введите фразу "Использовать плейсхолдеры"
3. В поле "Текст 2" введите фразу "Создавать настоящие мемы"
4. Для второго текстового поля измените размер шрифта на 28, используя соответствующий ползунок
5. Нажмите на цветной квадрат рядом с надписью "Цвет текста" и выберите зеленый цвет
6. Выберите значение "Полужирный" из выпадающего списка стилей шрифта
7. Убедитесь, что все изменения текста и стиля мгновенно отображаются на изображении мема

Когда вы изменяете текст, вызывается функция `handleTextChange(areaIndex, text)`, которая обновляет массив `textContent`. Изменение стиля обрабатывается функцией `handleTextStyleChange(areaIndex, styleKey, value)`. После каждого изменения React перерисовывает компонент, запуская функцию `renderTextOnCanvas()`, которая использует Canvas API для отображения текста с заданными параметрами на изображении.

## 4. Функция применения фильтров к изображению

**Назначение функции:**  
Позволяет применять визуальные фильтры к изображению мема, изменяя его яркость, контрастность и насыщенность. Дает возможность настроить визуальное восприятие мема.

**Протокол тестирования:**  
1. После выбора и редактирования текста мема перейдите на вкладку "Фильтры" в правой панели
2. Передвиньте ползунок "Яркость" вправо до значения 120
3. Установите ползунок "Контрастность" на значение 135
4. Установите ползунок "Насыщенность" на значение 110
5. Оцените, как изменилось изображение - оно должно стать ярче, контрастнее и немного насыщеннее
6. Нажмите кнопку "Сбросить фильтры", расположенную под ползунками
7. Убедитесь, что все фильтры вернулись к значению 100, а изображение - к исходному виду

При перемещении ползунка фильтра вызывается функция `handleFilterChange(filterType, value)`, которая обновляет объект `filters` в состоянии компонента. Эти значения передаются в функцию `applyFiltersToImage` библиотеки `image-utils.ts`, которая применяет CSS-фильтры к изображению на Canvas. Кнопка сброса вызывает функцию `handleResetFilters()`, возвращающую все значения к исходным.

## 5. Функция стилизации изображения с помощью ИИ

**Назначение функции:**  
Преобразует изображение мема, применяя к нему художественный стиль известных художников с помощью алгоритмов обработки изображений. Создает уникальный визуальный эффект.

**Протокол тестирования:**  
1. В правой панели перейдите на вкладку "Стилизация"
2. В сетке доступных стилей выберите "Звёздная ночь (Ван Гог)", щелкнув на соответствующей миниатюре
3. Нажмите кнопку "Применить стиль"
4. Обратите внимание на индикатор загрузки, который появляется во время обработки изображения
5. Дождитесь завершения процесса стилизации (обычно занимает 3-5 секунд)
6. Оцените результат - изображение должно приобрести характерные черты стиля Ван Гога (контрастные цвета, завихрения)
7. Нажмите кнопку "Вернуть оригинал" под изображением
8. Убедитесь, что изображение вернулось к исходному виду

Процесс стилизации включает несколько этапов:
1. Функция `handleApplyStyle()` создает снимок текущего изображения с Canvas и сохраняет оригинал
2. Изображение отправляется на сервер через POST-запрос к `/api/stylize` с указанием ID стиля
3. На сервере скрипт Python `stylization.py` получает изображение и применяет соответствующие фильтры:
   - Для стиля Ван Гога: увеличение контраста (1.5), насыщенности (1.8) и легкое размытие
4. Обработанное изображение возвращается клиенту в формате base64
5. Клиент обновляет `selectedTemplate.imageUrl` и меняет состояние `isStyleApplied`

## 6. Функция сохранения и экспорта мема

**Назначение функции:**  
Позволяет сохранить созданный мем в коллекции пользователя для последующего доступа или экспортировать его в виде файла для использования за пределами приложения.

**Протокол тестирования:**  
1. После завершения редактирования мема (добавление текста, применение фильтров и/или стилизации)
2. В поле "Название мема" в правой панели введите название "Мой первый мем"
3. Нажмите кнопку "Сохранить мем" под изображением
4. Обратите внимание на уведомление об успешном сохранении в правом верхнем углу экрана
5. Теперь нажмите кнопку "Скачать" рядом с кнопкой сохранения
6. Проверьте папку загрузок вашего браузера - там должен появиться файл "Мой_первый_мем.png"
7. Откройте этот файл в любом просмотрщике изображений и убедитесь, что он содержит созданный вами мем

При сохранении мема функция `handleSaveMeme()`:
1. Получает снимок Canvas в формате base64 с помощью `canvasRef.toDataURL()`
2. Формирует объект `memeData` с данными мема (название, изображение, примененные фильтры, тексты)
3. Отправляет этот объект на сервер через мутацию `saveMutation`
4. На сервере данные сохраняются в хранилище через метод `createSavedMeme()`

При скачивании функция `handleDownloadMeme()` создает временный элемент `<a>` с атрибутом `download` и программно инициирует клик по нему, вызывая стандартный диалог сохранения файла браузера.

## 7. Функция публикации мема в социальных сетях

**Назначение функции:**  
Обеспечивает быстрый способ поделиться созданным мемом в популярных социальных сетях без необходимости сначала сохранять файл.

**Протокол тестирования:**  
1. После создания мема найдите кнопку с иконкой "Поделиться" (иконка с расходящимися линиями) под изображением
2. Нажмите на эту кнопку - появится меню с иконками различных социальных сетей
3. Выберите опцию "Twitter" (или другую доступную сеть)
4. В новом окне или вкладке должна открыться страница Twitter с формой создания нового твита
5. Убедитесь, что в форме уже присутствует изображение вашего мема и стандартный текст
6. Закройте окно социальной сети без публикации

Компонент `SocialShare` выполняет следующие действия:
1. Получает данные Canvas через переданный `canvasRef`
2. Преобразует содержимое Canvas в URL-данные
3. Для каждой социальной сети формирует URL с соответствующими параметрами:
   - Для Twitter: `https://twitter.com/intent/tweet?text=...&url=...`
   - Для Facebook: `https://www.facebook.com/sharer/sharer.php?u=...`
4. При нажатии на кнопку открывает новое окно с сформированным URL
5. Социальная сеть самостоятельно обрабатывает переданные параметры и подготавливает форму для публикации

## Заключение

В результате тестирования было установлено, что все основные функции приложения для создания мемов работают корректно. Пользовательский интерфейс обеспечивает интуитивно понятное взаимодействие, а все операции выполняются с ожидаемым результатом. 

Особенно следует отметить эффективную работу функции стилизации изображений, которая успешно имитирует различные художественные стили. Интеграция Canvas API для манипуляций с изображениями и текстом также показала высокую производительность и точность.

Приложение демонстрирует хорошую отзывчивость интерфейса даже при работе с крупными изображениями и сложными эффектами, что свидетельствует о правильной архитектуре и эффективной реализации функций обработки данных.