# Протокол тестирования функции AI-стилизации

## Общее описание функции

Функция AI-стилизации в приложении для создания мемов предоставляет пользователям возможность применять художественные стили известных художников к изображениям. Реализация базируется на алгоритмах обработки изображений с помощью библиотеки PIL (Python Imaging Library) и специализированных фильтров, имитирующих различные художественные техники.

## Техническое описание реализации

Функция стилизации реализована как часть серверного API и использует скрипт Python для применения фильтров и преобразований к изображениям. Основной процесс включает:

1. **Клиентский компонент** (`ImageStyleEditor` в `client/src/components/image-editor.tsx`) предоставляет пользовательский интерфейс для выбора и применения стилей.

2. **Серверный эндпоинт** (`/api/stylize` в `server/routes.ts`) принимает запросы на стилизацию, обрабатывает данные изображения и вызывает Python-скрипт.

3. **Python-модуль** (`stylization.py`) включает следующие основные функции:
   - `load_img()` - загрузка изображения с помощью PIL
   - `save_image()` - сохранение обработанного изображения с высоким качеством
   - `apply_style()` - применение выбранного художественного стиля
   - `stylize_image()` - координация процесса стилизации

## Поддерживаемые стили

В текущей версии приложения реализованы следующие художественные стили:

1. **Звёздная ночь (Ван Гог)** - усиление контраста и насыщенности, легкое размытие для имитации мазков.

2. **Крик (Мунк)** - искажение цветов, увеличение контрастности и применение фильтра выделения краев.

3. **Композиция (Кандинский)** - увеличение яркости и контрастности, усиление четкости.

4. **Кубизм (Пикассо)** - выделение краев и постеризация, увеличение контраста.

5. **Водяные лилии (Моне)** - мягкое размытие, увеличение яркости и насыщенности цветов.

## Детальный протокол тестирования

### Тест 1: Выбор художественного стиля

**Цель**: Проверить корректность отображения доступных стилей и работу механизма выбора стиля.

**Порядок действий**:
1. Запустите приложение и перейдите в раздел "Генератор мемов"
2. Выберите любой шаблон мема для редактирования
3. В правой панели инструментов перейдите на вкладку "Стилизация"
4. Просмотрите доступные стили в виде сетки миниатюр
5. Выберите стиль "Звёздная ночь (Ван Гог)", щелкнув на его миниатюре

**Ожидаемый результат**:
- Все пять стилей должны отображаться в сетке миниатюр
- При выборе стиля его миниатюра должна быть визуально выделена (подсвечена)
- Имя выбранного стиля должно отображаться рядом с кнопкой "Применить стиль"

**Технический комментарий**:
При щелчке на миниатюре стиля вызывается функция `handleStyleSelect(style)`, которая сохраняет выбранный стиль в состоянии `selectedStyle`. Стили загружаются с сервера через API-запрос `/api/styles` и отображаются в компоненте `AiStyleSelector`.

### Тест 2: Применение стиля Ван Гога

**Цель**: Проверить процесс применения стиля "Звёздная ночь (Ван Гог)" к изображению.

**Порядок действий**:
1. Выберите шаблон мема "Drake Hotline Bling"
2. В панели стилизации выберите стиль "Звёздная ночь (Ван Гог)"
3. Нажмите кнопку "Применить стиль"
4. Дождитесь завершения процесса стилизации
5. Внимательно рассмотрите результат стилизации

**Ожидаемый результат**:
- Во время обработки должен отображаться индикатор загрузки
- После завершения обработки изображение должно демонстрировать характерные черты стиля Ван Гога:
  - Повышенная контрастность
  - Насыщенные, яркие цвета
  - Легкий эффект размытия, имитирующий мазки кисти
- Должно появиться уведомление об успешном применении стиля

**Технический комментарий**:
При нажатии кнопки "Применить стиль" вызывается асинхронная функция `handleApplyStyle()`, которая отправляет изображение на сервер через POST-запрос к `/api/stylize`. На сервере функция `stylize_image()` вызывает `apply_style()` с параметром стиля '1' (Ван Гог), который применяет:
```python
# Увеличение контраста в 1.5 раза
styled_img = ImageEnhance.Contrast(styled_img).enhance(1.5)
# Увеличение насыщенности в 1.8 раза
styled_img = ImageEnhance.Color(styled_img).enhance(1.8)
# Легкое размытие для эффекта мазков
styled_img = styled_img.filter(ImageFilter.GaussianBlur(radius=1))
```

### Тест 3: Применение стиля Мунка

**Цель**: Проверить процесс применения стиля "Крик (Мунк)" к изображению.

**Порядок действий**:
1. Выберите шаблон мема с крупными контрастными элементами
2. В панели стилизации выберите стиль "Крик (Мунк)"
3. Нажмите кнопку "Применить стиль"
4. Дождитесь завершения процесса стилизации
5. Оцените результат стилизации

**Ожидаемый результат**:
- Во время обработки должен отображаться индикатор загрузки
- После завершения обработки изображение должно демонстрировать характерные черты стиля Мунка:
  - Искаженные, экспрессивные формы
  - Размытость объектов
  - Выделенные края объектов
- Должно появиться уведомление об успешном применении стиля

**Технический комментарий**:
В этом случае функция `apply_style()` вызывается с параметром стиля '2' (Мунк) и применяет:
```python
# Умеренное увеличение контраста
styled_img = ImageEnhance.Contrast(styled_img).enhance(1.3)
# Размытие для создания "плывущего" эффекта
styled_img = styled_img.filter(ImageFilter.GaussianBlur(radius=2))
# Выделение краев для характерной экспрессивности
styled_img = styled_img.filter(ImageFilter.EDGE_ENHANCE)
```

### Тест 4: Отмена стилизации

**Цель**: Проверить возможность отмены примененного стиля и возврата к исходному изображению.

**Порядок действий**:
1. Выберите шаблон мема и примените к нему любой стиль (например, "Кубизм (Пикассо)")
2. После успешной стилизации нажмите кнопку "Вернуть оригинал"
3. Сравните полученное изображение с исходным

**Ожидаемый результат**:
- При нажатии на кнопку "Вернуть оригинал" изображение должно мгновенно вернуться к своему исходному виду
- Должно появиться уведомление о возврате к оригиналу
- Все эффекты примененного стиля должны исчезнуть, а исходные характеристики изображения (яркость, контрастность, четкость) должны быть восстановлены

**Технический комментарий**:
При первом применении стиля клиент сохраняет оригинальное изображение в состоянии `originalImageUrl`. Функция `handleRevertStyle()` возвращает это изображение, устанавливая его обратно в `selectedTemplate.imageUrl` и меняя состояние `isStyleApplied` на `false`.

### Тест 5: Комбинирование стилизации с другими функциями

**Цель**: Проверить работу функции стилизации в комбинации с другими функциями редактирования мема.

**Порядок действий**:
1. Выберите шаблон мема и добавьте текст в соответствующие области
2. Настройте стиль текста (размер, цвет, шрифт)
3. Примените стиль "Водяные лилии (Моне)" к изображению
4. Перейдите на вкладку "Фильтры" и увеличьте контрастность до 120
5. Вернитесь на вкладку "Стилизация" и нажмите "Вернуть оригинал"
6. Снова примените стиль, но теперь "Композиция (Кандинский)"
7. Сохраните полученный мем, используя кнопку "Сохранить мем"

**Ожидаемый результат**:
- Текст должен корректно отображаться как до, так и после применения стиля
- Применение фильтров должно работать независимо от стилизации
- Возврат к оригиналу должен сбрасывать только эффекты стилизации, но сохранять изменения текста
- Повторное применение другого стиля должно работать корректно
- Сохранение мема должно включать все примененные изменения, включая текст и стиль

**Технический комментарий**:
Этот тест проверяет взаимодействие различных компонентов системы:
- Компонент `TextEditor` управляет текстовым содержимым и его стилями
- Компонент `ImageStyleEditor` управляет процессом стилизации
- При сохранении мема функция `handleSaveMeme()` собирает все данные о примененных изменениях и отправляет их на сервер

### Тест 6: Обработка ошибок при стилизации

**Цель**: Проверить реакцию системы на ошибки при процессе стилизации.

**Порядок действий**:
1. Временно отключите выполнение Python-скрипта на сервере (можно закомментировать соответствующий код в `routes.ts`)
2. Выберите шаблон мема и попытайтесь применить любой стиль
3. Восстановите нормальную работу сервера и попробуйте снова

**Ожидаемый результат**:
- При ошибке на сервере клиент должен показать уведомление об ошибке
- Индикатор загрузки должен исчезнуть при ошибке
- Изображение должно остаться без изменений
- После восстановления работы сервера функция стилизации должна работать нормально

**Технический комментарий**:
Функция `handleApplyStyle()` включает блок `try-catch` для обработки ошибок. При возникновении ошибки:
- Отображается уведомление с описанием ошибки через компонент `toast`
- Состояние `isStyleLoading` устанавливается в `false`
- Изображение остается без изменений

## Выводы по результатам тестирования

Функция AI-стилизации изображений демонстрирует стабильную работу и хорошее качество результата. Все пять реализованных стилей корректно применяются к изображениям и создают характерные визуальные эффекты, соответствующие заявленным художественным стилям.

Пользовательский интерфейс обеспечивает интуитивно понятный процесс выбора и применения стилей с надлежащей обратной связью (индикаторы загрузки, уведомления). Функция корректно интегрируется с остальными компонентами редактирования мема и не нарушает работу других функций.

Перспективным направлением развития является внедрение более продвинутых алгоритмов нейронного переноса стиля, как указано в планах развития приложения. Текущая реализация, основанная на традиционных методах обработки изображений, обеспечивает хорошую базу для последующего расширения функциональности.